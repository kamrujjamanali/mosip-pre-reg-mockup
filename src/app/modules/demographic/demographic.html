<!-- src/app/demographic-upload/demographic-upload.component.html -->
<div class="page" [attr.data-theme]="theme">
  <!-- <div class="themeFloating">
    <select [ngModel]="theme" (ngModelChange)="changeTheme($event)">
      <option *ngFor="let t of themes" [value]="t.name">{{ t.label }}</option>
    </select>
  </div> -->

  <ng-container [ngSwitch]="theme">

    <!-- ===========================================================
         DEFAULT (MOSIP) – DO NOT REMOVE ANYTHING
         =========================================================== -->
    <ng-container *ngSwitchCase="'default'">

      <!-- Top MOSIP stepper strip -->
      <div class="dStepper">
        <div class="dStep active">
          <mat-icon class="dIcon">description</mat-icon>
          <span class="dStepText activeText">Demographics Details</span>
          <div class="dLine pinkLine"></div>
        </div>

        <div class="dStep">
          <mat-icon class="dIcon">upload</mat-icon>
          <span class="dStepText">Upload Document</span>
          <div class="dLine"></div>
        </div>

        <div class="dStep disabled">
          <mat-icon class="dIcon">event</mat-icon>
          <span class="dStepText">Book Appointment</span>
          <div class="dLine"></div>
        </div>

        <div class="dStep disabled">
          <mat-icon class="dIcon">description</mat-icon>
          <span class="dStepText">Confirmation</span>
        </div>
      </div>

      <div class="dContainer">

        <div class="dHeaderRow">
          <div class="dTitle">
            {{ activeStepIndex === 0 ? 'Demographic Details' : 'Upload Documents' }}
            ( {{ dataCaptureLanguage }} )
          </div>

          <button *ngIf="activeStepIndex === 0"
                  type="button"
                  class="dBtnPink"
                  (click)="changeDataCaptureLanguages()">
            CHANGE DATA CAPTURE LANGUAGES
          </button>
        </div>

        <div class="dPinkDivider"></div>

        <!-- ===================== DEMOGRAPHIC (12 fields) ===================== -->
        <ng-container *ngIf="activeStepIndex === 0">
          <div class="dGrid4">

            <!-- Full Name -->
            <div class="dCard">
              <div class="dCardHead">Full Name : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Full Name" [(ngModel)]="fullName" />
                  <button mat-icon-button matSuffix type="button"><mat-icon>keyboard</mat-icon></button>
                </mat-form-field>
              </div>
            </div>

            <!-- DOB -->
            <div class="dCard">
              <div class="dCardHead">Date Of Birth : <span class="req">*</span></div>
              <div class="dCardBody dDobRow">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <input
                    matInput
                    [matDatepicker]="dobPicker"
                    placeholder="DD/MM/YYYY"
                    [(ngModel)]="dob"
                  />
                  <button mat-icon-button matSuffix type="button" (click)="dobPicker.open()">
                    <mat-icon>calendar_month</mat-icon>
                  </button>
                
                  <mat-datepicker #dobPicker></mat-datepicker>
                </mat-form-field>                

                <div class="dOr">OR</div>

                <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Age" [(ngModel)]="age" />
                </mat-form-field>
                <label for="" style="margin-top: 15px;">Years</label>
                <!-- <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Years" [(ngModel)]="years" />
                </mat-form-field> -->
              </div>
            </div>

            <!-- Gender -->
            <div class="dCard">
              <div class="dCardHead">Gender : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="gender" placeholder="Gender">
                    <mat-option *ngFor="let g of genders" [value]="g.code">{{ g.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Residence -->
            <div class="dCard">
              <div class="dCardHead">Residence Status : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="residenceStatus" placeholder="Residence Status">
                    <mat-option *ngFor="let r of residenceStatuses" [value]="r.code">{{ r.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Address -->
            <div class="dCard">
              <div class="dCardHead">Address : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Address" [(ngModel)]="address" />
                  <button mat-icon-button matSuffix type="button"><mat-icon>keyboard</mat-icon></button>
                </mat-form-field>
              </div>
            </div>

            <!-- Region -->
            <div class="dCard">
              <div class="dCardHead">Region : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="region" placeholder="Region">
                    <mat-option *ngFor="let r of regions" [value]="r.code">{{ r.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Province -->
            <div class="dCard">
              <div class="dCardHead">Province : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="parish" placeholder="Province" (selectionChange)="onParishChange()">
                    <mat-option *ngFor="let p of parishes" [value]="p.code">{{ p.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- City -->
            <div class="dCard">
              <div class="dCardHead">City : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="city" placeholder="City" [disabled]="!parish">
                    <mat-option *ngFor="let c of cities" [value]="c.code">{{ c.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Zone -->
            <div class="dCard">
              <div class="dCardHead">Zone : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="zone" placeholder="Zone">
                    <mat-option *ngFor="let z of zones" [value]="z.code">{{ z.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Postal Code -->
            <div class="dCard">
              <div class="dCardHead">Postal Code : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <mat-select [(ngModel)]="postalCode" placeholder="Postal Code">
                    <mat-option *ngFor="let p of postalCodes" [value]="p.code">{{ p.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <!-- Phone -->
            <div class="dCard">
              <div class="dCardHead">Phone : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Phone" [(ngModel)]="phone" />
                </mat-form-field>
              </div>
            </div>

            <!-- Email -->
            <div class="dCard">
              <div class="dCardHead">Email : <span class="req">*</span></div>
              <div class="dCardBody">
                <mat-form-field class="w100 lineField" appearance="fill">
                  <input matInput placeholder="Email" [(ngModel)]="email" />
                </mat-form-field>
              </div>
            </div>

          </div>

          <div class="dBottomFixed">
            <button class="dBtnPink" type="button" (click)="goToUpload()">CONTINUE</button>
          </div>
        </ng-container>

        <!-- ===================== UPLOAD (eye icon -> right preview) ===================== -->
        <ng-container *ngIf="activeStepIndex === 1">
          <div class="dUploadNote">
            Allowed file type : {{ allowedTypes }} and allowed file size : {{ maxSizeText }}
          </div>

          <div class="dUploadLayout">
            <div class="dUploadLeft">
              <div class="dUploadCard" *ngFor="let d of documents">
                <div class="dCardHead">
                  {{ d.title }} <span *ngIf="d.required">: <span class="req">*</span></span>
                </div>

                <div class="dUploadBody">
                  <div class="dUploadRow">
                    <mat-form-field class="w100 lineField" appearance="fill">
                      <mat-select [(ngModel)]="d.docType" placeholder="{{ d.title }}">
                        <mat-option *ngFor="let opt of getDocTypeOptions(d.key)" [value]="opt.code">
                          {{ opt.label }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field class="w100 lineField" appearance="fill">
                      <input matInput placeholder="Document Reference Id" [(ngModel)]="d.refId" />
                    </mat-form-field>

                    <input #fileInput type="file" class="hiddenFile"
                           accept=".pdf,.png,.jpg,.jpeg"
                           (change)="onFileSelected(d, $event)" />

                    <button type="button" class="dBrowse" (click)="browseFile(d, fileInput)">BROWSE</button>
                  </div>

                  <div class="dFileRow" *ngIf="d.fileName">
                    <span class="dFileName">{{ d.fileName }}</span>
                    <div class="dFileIcons">
                      <button mat-icon-button type="button" (click)="preview(d)" title="Preview">
                        <mat-icon>visibility</mat-icon>
                      </button>
                      <button mat-icon-button type="button" (click)="remove(d)" title="Remove">
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>

            <div class="dUploadRight">
              <div class="dPreviewShell">
                <div class="dPreviewTitle" *ngIf="selectedPreviewTitle">{{ selectedPreviewTitle }}</div>

                <div class="dPreviewEmpty" *ngIf="previewKind === 'none'">
                  Click the eye icon to preview PDF/Image here.
                </div>

                <iframe *ngIf="previewKind === 'pdf' && safePdfUrl"
                        class="previewFrame"
                        [src]="safePdfUrl">
                </iframe>

                <div *ngIf="previewKind === 'image' && safeImgUrl" class="imgWrap">
                  <img [src]="safeImgUrl" alt="preview" />
                </div>
              </div>
            </div>
          </div>
          <div class="dBottomBar2">
            <button class="dBtnOutline" type="button" (click)="goToDemographic()">BACK</button>
            <button class="dBtnPink" type="button" (click)="goToDashboard()">CONTINUE</button>
          </div>
        </ng-container>

      </div>
    </ng-container>

    <!-- ===========================================================
         GOVT THEME (layout changed but keeps ALL demographic fields)
         =========================================================== -->
    <ng-container *ngSwitchCase="'svg_gov'">
      <div class="govBg">

        <div class="govShell">
          <div class="govCard">

            <div class="govHeaderRow">
              <div class="govPageTitle">
                {{ activeStepIndex === 0 ? 'Demographic Details' : 'Upload Documents' }}
                <span class="muted"> ( {{ dataCaptureLanguage }} )</span>
              </div>

              <button *ngIf="activeStepIndex === 0"
                      type="button"
                      class="govPrimaryBtn"
                      (click)="changeDataCaptureLanguages()">
                Change Data Capture Languages
              </button>
            </div>

            <div class="govDivider"></div>

            <div class="govStepper">
              <button type="button" class="govStep" [class.active]="activeStepIndex === 0" (click)="goToDemographic()">Demographics</button>
              <div class="govStepLine"></div>
              <button type="button" class="govStep" [class.active]="activeStepIndex === 1" (click)="goToUpload()">Upload</button>
              <div class="govStepLine"></div>
              <button type="button" class="govStep" [class.active]="activeStepIndex === 2">Book Appointment</button>
              <div class="govStepLine"></div>
              <button type="button" class="govStep" [class.active]="activeStepIndex === 3">Confirmation</button>
            </div>

            <!-- GOVT DEMO (ALL fields) -->
            <ng-container *ngIf="activeStepIndex === 0">
              <div class="govGrid">
                <div class="govField">
                  <label>Full Name <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <input matInput placeholder="Full Name" [(ngModel)]="fullName" />
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Date of Birth <span class="required">*</span></label>
                  <div class="govDobRow">
                    <!-- ✅ DOB with datepicker -->
                    <mat-form-field appearance="fill" class="w100 govMatField">
                      <input matInput [matDatepicker]="dobPickerGov" placeholder="DD/MM/YYYY" [(ngModel)]="dob" />
                      <button mat-icon-button matSuffix type="button" (click)="dobPickerGov.open()">
                        <mat-icon>calendar_month</mat-icon>
                      </button>
                      <mat-datepicker #dobPickerGov></mat-datepicker>
                    </mat-form-field>
                    <div class="govOr">OR</div>
                    <mat-form-field appearance="fill" class="w100 govMatField">
                      <input matInput placeholder="Age" [(ngModel)]="age" />
                    </mat-form-field>
                    <label>Years</label>
                    <!-- <mat-form-field appearance="fill" class="w100 govMatField">
                      <input matInput placeholder="Years" [(ngModel)]="years" />
                    </mat-form-field> -->
                  </div>
                </div>                

                <div class="govField">
                  <label>Gender <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="gender" placeholder="Gender">
                      <mat-option *ngFor="let g of genders" [value]="g.code">{{ g.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Residence Status <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="residenceStatus" placeholder="Residence Status">
                      <mat-option *ngFor="let r of residenceStatuses" [value]="r.code">{{ r.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Address <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <input matInput placeholder="Address" [(ngModel)]="address" />
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Region <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="region" placeholder="Region">
                      <mat-option *ngFor="let r of regions" [value]="r.code">{{ r.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Province <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="parish" placeholder="Province" (selectionChange)="onParishChange()">
                      <mat-option *ngFor="let p of parishes" [value]="p.code">{{ p.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>City <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="city" placeholder="City" [disabled]="!parish">
                      <mat-option *ngFor="let c of cities" [value]="c.code">{{ c.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Zone <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="zone" placeholder="Zone">
                      <mat-option *ngFor="let z of zones" [value]="z.code">{{ z.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Postal Code <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <mat-select [(ngModel)]="postalCode" placeholder="Postal Code">
                      <mat-option *ngFor="let p of postalCodes" [value]="p.code">{{ p.label }}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Phone <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <input matInput placeholder="Phone" [(ngModel)]="phone" />
                  </mat-form-field>
                </div>

                <div class="govField">
                  <label>Email <span class="required">*</span></label>
                  <mat-form-field appearance="outline" class="w100 govMatField">
                    <input matInput placeholder="Email" [(ngModel)]="email" />
                  </mat-form-field>
                </div>
              </div>

              <div class="govBottom">
                <div></div>
                <button type="button" class="govPrimaryBtn" (click)="goToUpload()">Continue</button>
              </div>
            </ng-container>

            <!-- GOVT UPLOAD (eye -> preview) -->
            <ng-container *ngIf="activeStepIndex === 1">
              <div class="govUploadNote">Allowed: {{ allowedTypes }} • Max: {{ maxSizeText }}</div>

              <div class="govUploadLayout">
                <div>
                  <div class="govDocPanel" *ngFor="let d of documents">
                    <div class="govDocHead">{{ d.title }} <span *ngIf="d.required" class="required">*</span></div>
                    <div class="govDocBody">
                      <mat-form-field appearance="outline" class="w40 govMatField" style="margin-right: 9px;">
                        <mat-select [(ngModel)]="d.docType" placeholder="Document type">
                          <mat-option *ngFor="let opt of getDocTypeOptions(d.key)" [value]="opt.code">{{ opt.label }}</mat-option>
                        </mat-select>
                      </mat-form-field>

                      <mat-form-field appearance="outline" class="w40 govMatField" style="margin-right: 9px;">
                        <input matInput placeholder="Reference Id" [(ngModel)]="d.refId" />
                      </mat-form-field>

                      <input #fileInput type="file" class="hiddenFile"
                             accept=".pdf,.png,.jpg,.jpeg"
                             (change)="onFileSelected(d, $event)" />

                      <button type="button" class="govOutlineBtn" (click)="browseFile(d, fileInput)">Browse</button>

                      <div class="govFileRow" *ngIf="d.fileName">
                        <span class="govFileName">{{ d.fileName }}</span>
                        <span class="govFileActions">
                          <button mat-icon-button type="button" (click)="preview(d)"><mat-icon>visibility</mat-icon></button>
                          <button mat-icon-button type="button" (click)="remove(d)"><mat-icon>delete</mat-icon></button>
                        </span>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="govPreview">
                  <div class="govPreviewTitle" *ngIf="selectedPreviewTitle">{{ selectedPreviewTitle }}</div>
                  <div class="govPreviewEmpty" *ngIf="previewKind === 'none'">Preview will appear here.</div>

                  <iframe *ngIf="previewKind === 'pdf' && safePdfUrl" class="previewFrame" [src]="safePdfUrl"></iframe>

                  <div *ngIf="previewKind === 'image' && safeImgUrl" class="imgWrap">
                    <img [src]="safeImgUrl" alt="preview" />
                  </div>
                </div>

              </div>
              <div class="govBottom">
                <button type="button" class="govOutlineBtn" (click)="goToDemographic()">Back</button>
                <button type="button" class="govPrimaryBtn" (click)="goToDashboard()">Continue</button>
              </div>
            </ng-container>

          </div>
        </div>
      </div>
    </ng-container>

    <!-- ===========================================================
         MODERN THEME (photo bg + centered card, keeps ALL fields)
         =========================================================== -->
    <ng-container *ngSwitchCase="'modern'">
      <div class="modernPhotoBg">
        <div class="modernCardShell">

          <div class="modernTop">
            <div class="modernTitle">
              {{ activeStepIndex === 0 ? 'Demographic Details' : 'Upload Documents' }}
              <span class="muted"> ( {{ dataCaptureLanguage }} )</span>
            </div>

            <button *ngIf="activeStepIndex === 0"
                    type="button"
                    class="modernPrimaryBtn"
                    (click)="changeDataCaptureLanguages()">
              Change Data Capture Languages
            </button>
          </div>

          <div class="modernLine"></div>

          <div class="modernPills">
            <button type="button" class="pill" [class.active]="activeStepIndex === 0" (click)="goToDemographic()">Demographics</button>
            <div class="modernStepLine"></div>
            <button type="button" class="pill" [class.active]="activeStepIndex === 1" (click)="goToUpload()">Upload</button>
            <div class="modernStepLine"></div>
            <button type="button" class="pill" [class.active]="activeStepIndex === 2">Book Appointment</button>
            <div class="modernStepLine"></div>
            <button type="button" class="pill" [class.active]="activeStepIndex === 3">Confirmation</button>
          </div>

          <!-- MODERN DEMO (ALL fields) -->
          <ng-container *ngIf="activeStepIndex === 0">
            <div class="modernGrid4">
              <div class="modernField">
                <label>Full Name *</label>
                <mat-form-field appearance="outline" class="w100">
                  <input matInput placeholder="Full Name" [(ngModel)]="fullName" />
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Date Of Birth *</label>
                <div class="modernDobRow">
                  <mat-form-field appearance="outline" class="w100">
                    <input matInput placeholder="DD/MM/YYYY" [(ngModel)]="dob" />
                  </mat-form-field>
                  <div class="mOr">OR</div>
                  <mat-form-field appearance="outline" class="w100">
                    <input matInput placeholder="Age" [(ngModel)]="age" />
                  </mat-form-field>
                  <mat-form-field appearance="outline" class="w100">
                    <input matInput placeholder="Years" [(ngModel)]="years" />
                  </mat-form-field>
                </div>
              </div>

              <div class="modernField">
                <label>Gender *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="gender" placeholder="Gender">
                    <mat-option *ngFor="let g of genders" [value]="g.code">{{ g.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Residence Status *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="residenceStatus" placeholder="Residence Status">
                    <mat-option *ngFor="let r of residenceStatuses" [value]="r.code">{{ r.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Address *</label>
                <mat-form-field appearance="outline" class="w100">
                  <input matInput placeholder="Address" [(ngModel)]="address" />
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Region *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="region" placeholder="Region">
                    <mat-option *ngFor="let r of regions" [value]="r.code">{{ r.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Province *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="parish" placeholder="Province" (selectionChange)="onParishChange()">
                    <mat-option *ngFor="let p of parishes" [value]="p.code">{{ p.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>City *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="city" placeholder="City" [disabled]="!parish">
                    <mat-option *ngFor="let c of cities" [value]="c.code">{{ c.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Zone *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="zone" placeholder="Zone">
                    <mat-option *ngFor="let z of zones" [value]="z.code">{{ z.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Postal Code *</label>
                <mat-form-field appearance="outline" class="w100">
                  <mat-select [(ngModel)]="postalCode" placeholder="Postal Code">
                    <mat-option *ngFor="let p of postalCodes" [value]="p.code">{{ p.label }}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Phone *</label>
                <mat-form-field appearance="outline" class="w100">
                  <input matInput placeholder="Phone" [(ngModel)]="phone" />
                </mat-form-field>
              </div>

              <div class="modernField">
                <label>Email *</label>
                <mat-form-field appearance="outline" class="w100">
                  <input matInput placeholder="Email" [(ngModel)]="email" />
                </mat-form-field>
              </div>
            </div>

            <div class="modernBottom">
              <div></div>
              <button type="button" class="modernPrimaryBtn" (click)="goToUpload()">Continue</button>
            </div>
          </ng-container>

          <!-- MODERN UPLOAD -->
          <ng-container *ngIf="activeStepIndex === 1">
            <div class="modernNote">Allowed: {{ allowedTypes }} • Max: {{ maxSizeText }}</div>

            <div class="modernUploadLayout">
              <div>
                <div class="modernDocTile" *ngFor="let d of documents">
                  <div class="tileHead">
                    <div class="tileTitle">{{ d.title }}</div>
                    <div class="tileReq" *ngIf="d.required">Required</div>
                  </div>

                  <div class="tileBody">
                    <mat-form-field appearance="outline" class="w39" style="margin-right: 9px;">
                      <mat-select [(ngModel)]="d.docType" placeholder="Document type">
                        <mat-option *ngFor="let opt of getDocTypeOptions(d.key)" [value]="opt.code">{{ opt.label }}</mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="w39" style="margin-right: 9px;">
                      <input matInput placeholder="Reference ID" [(ngModel)]="d.refId" />
                    </mat-form-field>
                    <button type="button" class="modernOutlineBtn" (click)="browseFile(d, fileInput)">Browse</button>

                    <input #fileInput type="file" class="hiddenFile"
                           accept=".pdf,.png,.jpg,.jpeg"
                           (change)="onFileSelected(d, $event)" />
                    <div class="modernRow">
                      <div class="fileMini" *ngIf="d.fileName">{{ d.fileName }}</div>
                      <div class="tileActions">
                        <button *ngIf="d.fileName" mat-icon-button type="button" (click)="preview(d)" title="Preview">
                          <mat-icon>visibility</mat-icon>
                        </button>
                        <button *ngIf="d.fileName" mat-icon-button type="button" (click)="remove(d)" title="Remove">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </div>
                    </div>

                  </div>
                </div>

              </div>

              <div class="modernPreview">
                <div class="prevTitle" *ngIf="selectedPreviewTitle">{{ selectedPreviewTitle }}</div>
                <div class="prevEmpty" *ngIf="previewKind === 'none'">Click eye icon to preview.</div>

                <iframe *ngIf="previewKind === 'pdf' && safePdfUrl" class="previewFrame" [src]="safePdfUrl"></iframe>

                <div *ngIf="previewKind === 'image' && safeImgUrl" class="imgWrap">
                  <img [src]="safeImgUrl" alt="preview" />
                </div>
              </div>
            </div>
            <div class="modernBottom">
              <button type="button" class="modernOutlineBtn" (click)="goToDemographic()">Back</button>
              <button type="button" class="modernPrimaryBtn" (click)="goToDashboard()">Continue</button>
            </div>
          </ng-container>

        </div>
      </div>
    </ng-container>

  </ng-container>
</div>
